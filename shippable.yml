language: node_js

node_js:
  - "0.10"

addons:
   firefox: "21.0"

install:
  - cd backend
  - pip install -r requirements.txt --use-mirrors
  - cd ../www
  - npm install
  - bower install
  - cd ..

before_script:
  - pwd
  - mkdir -p shippable/testresults
  - mkdir -p shippable/codecoverage
  - mkdir -p shippable/screenshots
  - export DISPLAY=:99.0
  - sh -e /etc/init.d/xvfb start
  - www/node_modules/.bin/http-server -p 8081 www/app/ &
  - sleep 1

script:
  - pwd
  - cd www
  - node_modules/.bin/gulp karma
  - node_modules/.bin/gulp protractor
  - node_modules/.bin/gulp jshint
  - node_modules/.bin/gulp changelog
  - node_modules/.bin/istanbul report cobertura --dir ../shippable/codecoverage/
  - cd ../backend
  - export PYTHONPATH=$PYTHONPATH:.
  #- nosetests tests/TestDatabase.py --with-xunit --xunit-file=../shippable/testresults/nosetests.xml
  - nosetests tests/TestDatabase.py --with-xunit --xunit-file=../shippable/testresults/nosetests.xml --with-coverage --cover-xml-file=../shippable/codecoverage/py-coverage.xml --cover-xml
  - cd ..
  #- sudo ./build-shippable.sh

after_success:
  - pwd
  - echo $BUILD_NUMBER
  - sudo tar cvf yafra-python-build.tar .
